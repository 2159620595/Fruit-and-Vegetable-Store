# æ•°æ®åº“éƒ¨ç½²é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸš¨ é—®é¢˜æè¿°

æ‰§è¡Œ `database-recharge-system.sql` æ—¶å‡ºç°é”™è¯¯ï¼š

```
#1060 - Duplicate column name 'balance'
```

## ğŸ” é—®é¢˜åŸå› 

æ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ `balance` å­—æ®µï¼Œä¸èƒ½é‡å¤æ·»åŠ ã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ç®€åŒ–ç‰ˆè„šæœ¬ï¼ˆæ¨èï¼‰

ä½¿ç”¨ `database-recharge-system-simple.sql` è„šæœ¬ï¼Œå®ƒåªæ·»åŠ ç¼ºå¤±çš„å­—æ®µï¼š

```bash
# æ‰§è¡Œç®€åŒ–ç‰ˆè„šæœ¬
mysql -u root -p fresh_harvest < database-recharge-system-simple.sql
```

### æ–¹æ¡ˆäºŒï¼šæ‰‹åŠ¨æ£€æŸ¥å¹¶æ·»åŠ ç¼ºå¤±å­—æ®µ

1. **æ£€æŸ¥å½“å‰ç”¨æˆ·è¡¨ç»“æ„**ï¼š

```sql
DESCRIBE users;
```

2. **åªæ·»åŠ ç¼ºå¤±çš„å­—æ®µ**ï¼š

```sql
-- å¦‚æœ membership_level å­—æ®µä¸å­˜åœ¨ï¼Œæ·»åŠ å®ƒ
ALTER TABLE users ADD COLUMN membership_level VARCHAR(20) DEFAULT 'æ™®é€šä¼šå‘˜' COMMENT 'ä¼šå‘˜ç­‰çº§';

-- å¦‚æœ total_recharge å­—æ®µä¸å­˜åœ¨ï¼Œæ·»åŠ å®ƒ
ALTER TABLE users ADD COLUMN total_recharge DECIMAL(10,2) DEFAULT 0.00 COMMENT 'ç´¯è®¡å……å€¼é‡‘é¢';
```

3. **ç„¶åæ‰§è¡Œå…¶ä»–è¡¨çš„åˆ›å»º**ï¼š

```sql
-- åˆ›å»ºå……å€¼è®°å½•è¡¨
CREATE TABLE IF NOT EXISTS recharge_records (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    amount DECIMAL(10,2) NOT NULL COMMENT 'å……å€¼é‡‘é¢',
    bonus_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT 'èµ é€é‡‘é¢',
    total_amount DECIMAL(10,2) NOT NULL COMMENT 'å®é™…åˆ°è´¦é‡‘é¢',
    payment_method VARCHAR(20) NOT NULL COMMENT 'æ”¯ä»˜æ–¹å¼: alipay, wechat, bank',
    payment_status ENUM('pending', 'success', 'failed', 'cancelled') DEFAULT 'pending' COMMENT 'æ”¯ä»˜çŠ¶æ€',
    transaction_id VARCHAR(100) COMMENT 'ç¬¬ä¸‰æ–¹äº¤æ˜“ID',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_payment_status (payment_status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å……å€¼è®°å½•è¡¨';
```

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨æ£€æŸ¥è„šæœ¬

1. **å…ˆè¿è¡Œæ£€æŸ¥è„šæœ¬**ï¼š

```bash
mysql -u root -p fresh_harvest < check-database-structure.sql
```

2. **æ ¹æ®æ£€æŸ¥ç»“æœï¼Œåªæ‰§è¡Œéœ€è¦çš„éƒ¨åˆ†**

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### 1. æ£€æŸ¥å½“å‰æ•°æ®åº“çŠ¶æ€

```sql
-- æ£€æŸ¥ç”¨æˆ·è¡¨å­—æ®µ
SELECT COLUMN_NAME, DATA_TYPE, COLUMN_DEFAULT, COLUMN_COMMENT
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = DATABASE()
AND TABLE_NAME = 'users'
AND COLUMN_NAME IN ('balance', 'membership_level', 'total_recharge');
```

### 2. æ‰§è¡Œç®€åŒ–ç‰ˆè„šæœ¬

```bash
mysql -u root -p fresh_harvest < database-recharge-system-simple.sql
```

### 3. éªŒè¯éƒ¨ç½²ç»“æœ

```sql
-- æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
SHOW TABLES LIKE '%recharge%';
SHOW TABLES LIKE '%balance%';
SHOW TABLES LIKE '%membership%';

-- æ£€æŸ¥ç”¨æˆ·è¡¨å­—æ®µ
DESCRIBE users;

-- æ£€æŸ¥è§†å›¾
SHOW CREATE VIEW v_user_balance_info;

-- æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹
SHOW PROCEDURE STATUS WHERE Db = DATABASE();
```

## ğŸ”§ å¦‚æœä»æœ‰é—®é¢˜

### 1. æ£€æŸ¥MySQLç‰ˆæœ¬

```sql
SELECT VERSION();
```

### 2. æ£€æŸ¥å­—ç¬¦é›†

```sql
SHOW VARIABLES LIKE 'character_set%';
```

### 3. æ£€æŸ¥å­˜å‚¨å¼•æ“

```sql
SHOW ENGINES;
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½æ•°æ®**ï¼šæ‰§è¡Œä»»ä½•æ•°æ®åº“ä¿®æ”¹å‰ï¼Œè¯·å…ˆå¤‡ä»½æ•°æ®
2. **æƒé™æ£€æŸ¥**ï¼šç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡ŒDDLæ“ä½œ
3. **å­—ç¬¦é›†**ï¼šç¡®ä¿ä½¿ç”¨utf8mb4å­—ç¬¦é›†
4. **å­˜å‚¨å¼•æ“**ï¼šç¡®ä¿ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“

## ğŸš€ å¿«é€Ÿè§£å†³å‘½ä»¤

å¦‚æœæ‚¨æƒ³å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

```bash
# 1. å¤‡ä»½æ•°æ®åº“ï¼ˆå¯é€‰ä½†æ¨èï¼‰
mysqldump -u root -p fresh_harvest > backup_$(date +%Y%m%d_%H%M%S).sql

# 2. æ‰§è¡Œç®€åŒ–ç‰ˆè„šæœ¬
mysql -u root -p fresh_harvest < database-recharge-system-simple.sql

# 3. éªŒè¯ç»“æœ
mysql -u root -p fresh_harvest -e "SHOW TABLES LIKE '%recharge%';"
```

## ğŸ“ å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨

å¦‚æœæŒ‰ç…§ä¸Šè¿°æ­¥éª¤ä»ç„¶æœ‰é—®é¢˜ï¼Œè¯·ï¼š

1. æä¾›å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
2. æä¾›å½“å‰æ•°æ®åº“è¡¨ç»“æ„
3. æä¾›MySQLç‰ˆæœ¬ä¿¡æ¯

è¿™æ ·æˆ‘å¯ä»¥æä¾›æ›´å…·ä½“çš„è§£å†³æ–¹æ¡ˆã€‚
