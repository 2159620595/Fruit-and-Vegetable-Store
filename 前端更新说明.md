# 前端更新说明 - Quick Start

## 🎯 本次更新概览

根据新增的后端接口和数据库优化，前端进行了以下更新：

### ✨ 新增功能

1. **订单搜索** - 支持按订单号或商品名称搜索
2. **订单状态流转** - 一键将订单状态更新到下一阶段
3. **物流查询优化** - 优先使用后端真实数据
4. **批量操作** - 支持批量更新订单状态（Store层已实现）
5. **订单统计** - 支持多维度统计数据（Store层已实现）

---

## 📦 更新的文件列表

### 1. API 层

- **文件：** `src/api/order.js`
- **新增接口：**
  - `getLogistics(orderId)` - 获取物流信息
  - `searchOrders(params)` - 搜索订单
  - `batchUpdateOrderStatus(data)` - 批量更新订单状态
  - `getOrderStatistics(params)` - 获取订单统计

### 2. Store 层

- **文件：** `src/stores/orderStore.js`
- **新增 Actions：**
  - `searchOrders(params)` - 搜索订单
  - `batchUpdateOrderStatus(data)` - 批量更新状态
  - `getOrderStatistics(params)` - 获取统计数据
- **优化 Actions：**
  - `updateOrderStatus(id, status)` - 支持后端状态流转验证

### 3. 视图层

- **文件：** `src/views/OrderList.vue`
- **新增功能：**
  - 搜索框（页面头部）
  - 状态流转按钮（待发货、已发货、运输中订单）
- **新增函数：**
  - `handleSearch()` - 执行搜索
  - `handleSearchClear()` - 清除搜索
  - `startAutoStatusFlow(order)` - 订单状态流转

### 4. 组件层

- **文件：** `src/components/LogisticsTracker.vue`
- **优化：**
  - 优先使用后端 `/api/logistics/:orderId` 接口
  - 失败时自动 fallback 到模拟数据

---

## 🚀 启动项目

### 1. 确保后端已启动

```bash
# 进入后端目录（如果有单独的后端目录）
cd backend

# 启动后端服务
node app.js

# 应该看到：
# 🚀 Fresh Harvest 电商系统后端服务已启动 (完整优化版)
# 📍 服务地址: http://localhost:3000
```

### 2. 启动前端开发服务器

```bash
# 在项目根目录
npm run dev

# 或
npm run serve
```

### 3. 访问项目

打开浏览器访问：`http://localhost:5173`（或控制台显示的端口）

---

## 🎮 功能测试指南

### 测试 1：订单搜索

1. 进入订单列表页面（`/orders`）
2. 在页面右上角搜索框输入：
   - **订单号：** `ORD1760870718178E39KNDJGB`
   - **商品名称：** `芒果`
3. 点击搜索按钮或按回车
4. **期望结果：**
   - 显示匹配的订单
   - 显示找到的订单数量提示

### 测试 2：订单状态流转

#### 2.1 待发货 → 已发货

1. 找到一个**待发货**状态的订单
2. 点击"**流转到下一状态**"按钮
3. 在确认对话框中点击"确定"
4. **期望结果：**
   - 订单状态变为"已发货"
   - 显示成功提示
   - 订单列表自动刷新

#### 2.2 已发货 → 运输中

1. 找到一个**已发货**状态的订单
2. 点击"**标记为运输中**"按钮
3. 确认后状态更新为"运输中"

#### 2.3 运输中 → 已送达

1. 找到一个**运输中**状态的订单
2. 点击"**标记为已送达**"按钮
3. 确认后状态更新为"已送达"

#### 2.4 非法流转测试

1. 找到一个**已送达**状态的订单
2. 尝试将其状态改为其他状态
3. **期望结果：**
   - 后端返回错误："订单状态不能从"已送达"变更为"XXX""
   - 前端显示错误提示

### 测试 3：物流信息查询

1. 找到一个已发货或运输中的订单
2. 点击"**查看物流**"按钮
3. **期望结果：**
   - 打开物流追踪对话框
   - 显示物流单号和承运商
   - 显示物流轨迹时间线
   - 如果后端API正常，显示真实数据
   - 如果后端API失败，显示模拟数据（会有控制台警告）

---

## 🔧 配置说明

### API 基础地址

确保 `src/utils/request.js` 中的 `baseURL` 正确：

```javascript
const service = axios.create({
  baseURL: 'https://www.xingyunfeicui.xyz/api', // 或你的后端地址
  timeout: 10000,
})
```

### 环境变量

如果使用环境变量，在 `.env` 文件中配置：

```env
VITE_API_BASE_URL=http://localhost:3000/api
```

然后在 `request.js` 中：

```javascript
const service = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000,
})
```

---

## 🐛 常见问题

### Q1: 搜索功能返回空结果

**可能原因：**

- 后端接口未实现或未启动
- 搜索关键词不匹配任何订单

**解决方法：**

1. 检查后端控制台是否有日志
2. 使用浏览器开发者工具查看网络请求
3. 确认数据库中有匹配的订单

### Q2: 状态流转按钮点击无反应

**可能原因：**

- 后端 `/api/orders/:id/status` 接口未实现
- 网络请求失败
- 订单状态不符合流转规则

**解决方法：**

1. 打开浏览器控制台查看错误信息
2. 检查后端日志
3. 确认订单当前状态是否支持流转

### Q3: 物流信息显示模拟数据

**原因：**

- 这是正常的 fallback 机制
- 后端 `/api/logistics/:orderId` 接口调用失败时，自动使用模拟数据

**如何使用真实数据：**

1. 确保后端服务已启动
2. 确保 `database-update.sql` 已执行
3. 确保订单有 `tracking_number` 字段数据

---

## 📊 接口调用示例

### 1. 搜索订单

**请求：**

```javascript
await orderStore.searchOrders({
  keyword: '芒果',
  page: 1,
  page_size: 10,
})
```

**响应：**

```json
{
  "code": 200,
  "data": {
    "orders": [...],
    "total": 12
  }
}
```

### 2. 更新订单状态

**请求：**

```javascript
await orderStore.updateOrderStatus(55, 'shipped')
```

**成功响应：**

```json
{
  "code": 200,
  "message": "订单状态更新成功"
}
```

**失败响应（非法流转）：**

```json
{
  "code": 400,
  "message": "订单状态不能从"已送达"变更为"已发货""
}
```

### 3. 获取物流信息

**请求：**

```javascript
const response = await getLogistics(55)
```

**响应：**

```json
{
  "code": 200,
  "data": {
    "order_id": 55,
    "tracking_number": "SF1760870718178",
    "carrier": "顺丰速运",
    "status": "delivered",
    "traces": [...]
  }
}
```

---

## 🎨 UI 截图位置

### 搜索框位置

```
┌─────────────────────────────────────────┐
│  我的订单                    [搜索框] [刷新] │
└─────────────────────────────────────────┘
```

### 状态流转按钮位置

```
订单卡片
├── 订单头部
├── 订单商品
└── 订单操作
    ├── [流转到下一状态]  ← 新增
    ├── [联系商家]
    └── [取消订单]
```

---

## 📞 技术支持

如遇到问题，请检查：

1. **浏览器控制台** - 查看前端错误
2. **网络请求** - 查看 API 调用情况
3. **后端日志** - 查看服务端错误
4. **数据库** - 确认数据是否正确

---

## 📚 更多文档

- **详细优化总结：** `项目优化完成总结.md`
- **后端部署指南：** `后端部署指南.md`
- **API 文档：** `backend-README.md`
- **数据库更新：** `database-update.sql`

---

**版本：** 2.0.0  
**更新日期：** 2025-10-20  
**前端框架：** Vue 3 + Vite + Element Plus

祝开发愉快！🎉
